<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Alternative Fuel Stations</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.21/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.21/"></script>

    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/layers/FeatureLayer",
            "esri/widgets/Legend"
        ], function (Map, MapView, FeatureLayer, Legend) {

            // Prompt user for state
            const stateInput = prompt("Enter the state abbreviation (e.g., 'CA' for California):");
            if (!stateInput || stateInput.length !== 2) {
                alert("Please enter a valid two-letter state abbreviation.");
                return;
            }

            // Step 1: Create the map
            const map = new Map({
                basemap: "streets-navigation-vector"
            });

            // Step 2: Create the MapView
            const view = new MapView({
                container: "viewDiv",
                map: map,
                center: [-98.5795, 39.8283], 
                zoom: 4
            });

            // Step 3: Define the renderer with PictureMarkerSymbol
            const fuelRenderer = {
                type: "unique-value",
                field: "Fuel_Type",
                uniqueValueInfos: [
                    {
                        value: "ELEC",
                        symbol: {
                            type: "picture-marker",
                            url: "images/electric.png", 
                            width: "24px",
                            height: "24px"
                        },
                        label: "Electric"
                    },
                    {
                        value: "LPG",
                        symbol: {
                            type: "picture-marker",
                            url: "images/Propane.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Propane (LPG)"
                    },
                    {
                        value: "BD", 
                        symbol: {
                            type: "picture-marker",
                            url: "images/biodiesel.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Biodiesel"
                    },
                    {
                        value: "CNG",
                        symbol: {
                            type: "picture-marker",
                            url: "images/CNG.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Compressed Natural Gas (CNG)"
                    },
                    {
                        value: "Hydrogen", 
                        symbol: {
                            type: "picture-marker",
                            url: "images/hydrogen.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Hydrogen"
                    },
                    {
                        value: "Liquefied Natural Gas (LNG)",
                        symbol: {
                            type: "picture-marker",
                            url: "images/LNG.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Liquefied Natural Gas (LNG)"
                    },
                    {
                        value: "E85", 
                        symbol: {
                            type: "picture-marker",
                            url: "images/ethanol.png",
                            width: "24px",
                            height: "24px"
                        },
                        label: "Ethanol (E85)"
                    }
                ]
            };

            // Step 4: Define the FeatureLayer for Alternative Fuel Stations
            const fuelStationsLayer = new FeatureLayer({
                url: "https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/Alternate_Fuel/FeatureServer/0", 
                renderer: fuelRenderer,
                popupTemplate: {
                    title: "Fuel Station",
                    content: `<b>Fuel Type:</b> {Fuel_Type}<br>
                              <b>Station Name:</b> {Station_Name}<br>
                              <b>Address:</b> {Address}`
                },
                outFields: ["Fuel_Type", "Station_Name", "Address"],
                definitionExpression: `State = '${stateInput.toUpperCase()}' AND Country = 'US'` // Filter for user-provided state and country
            });

            // Step 5: Add the layer to the map and adjust the view
            map.add(fuelStationsLayer);

            // Wait for the layer to load and then zoom to the features in the state
            fuelStationsLayer.when(() => {
                fuelStationsLayer.queryExtent({
                    where: `State = '${stateInput.toUpperCase()}' AND Country = 'US'`
                }).then((result) => {
                    if (result.extent) {
                        view.goTo(result.extent.expand(1.5));
                    } else {
                        alert("No stations found for the specified state.");
                    }
                });
            });

            // Step 6: Add the Legend widget
            const legend = new Legend({
                view: view,
                layerInfos: [{
                    layer: fuelStationsLayer,
                    title: "Alternative Fuel Stations"
                }]
            });

            // Step 7: Position the legend widget
            view.ui.add(legend, "bottom-right");
        });
    </script>

</head>

<body>
    <div id="viewDiv"></div>
</body>
</html>
